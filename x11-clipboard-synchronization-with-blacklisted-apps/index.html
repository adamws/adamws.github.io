<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://adamws.github.io/x11-clipboard-synchronization-with-blacklisted-apps/"><meta property="og:site_name" content="adamws.github.io"><meta property="og:title" content="X11 clipboard synchronization with blacklisted apps"><meta property="og:description" content="If you are X11 user, you have two main selection types 1 (often called clipboards) to your disposal:
PRIMARY: used when you select text with the mouse and use middle-mouse button to paste it CLIPBOARD: used for explicitly copy/paste commands, most typically ctrl+c/ctrl+v shortcuts I’m sure that this is useful for some, but if you are anything like me, single clipboard would be sufficient and easier to use. Thankfully, this is easily achievable with autocutsel 2 which I start in my .xinitrc:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-06T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="X11 clipboard synchronization with blacklisted apps"><meta name=twitter:description content="If you are X11 user, you have two main selection types 1 (often called clipboards) to your disposal:
PRIMARY: used when you select text with the mouse and use middle-mouse button to paste it CLIPBOARD: used for explicitly copy/paste commands, most typically ctrl+c/ctrl+v shortcuts I’m sure that this is useful for some, but if you are anything like me, single clipboard would be sufficient and easier to use. Thankfully, this is easily achievable with autocutsel 2 which I start in my .xinitrc:"><script async src="https://www.googletagmanager.com/gtag/js?id=G-47SFRLYXCP"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-47SFRLYXCP")}</script><script defer src=https://cloud.umami.is/script.js data-website-id=dbdd840e-6074-41d4-8a10-7985bb486522></script><title>adamws.github.io - X11 clipboard synchronization with blacklisted apps
</title><link rel=stylesheet href=https://adamws.github.io/css/style.css></head><script></script><body><div id=content><div class=post><h1>X11 clipboard synchronization with blacklisted apps</h1><p>If you are X11 user, you have two main selection types <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> (often called clipboards) to your disposal:</p><ul><li>PRIMARY: used when you select text with the mouse and use middle-mouse button to paste it</li><li>CLIPBOARD: used for explicitly copy/paste commands, most typically <em>ctrl+c</em>/<em>ctrl+v</em> shortcuts</li></ul><p>I&rsquo;m sure that this is useful for some, but if you are anything like me, single clipboard would be sufficient
and easier to use.
Thankfully, this is easily achievable with <code>autocutsel</code> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> which I start in my <code>.xinitrc</code>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>autocutsel -fork <span style=color:#1f2328>&amp;</span>
</span></span><span style=display:flex><span>autocutsel -selection PRIMARY -fork <span style=color:#1f2328>&amp;</span>
</span></span></code></pre></td></tr></table></div></div><p>With this daemons running, there is both way synchronization between clipboards. Anything selected with mouse
can be pasted with <em>ctrl+v</em>, anything copied with <em>ctrl+c</em> can be pasted with middle mouse button.</p><p>That&rsquo;s great but there is one catch! Some applications may automatically select text. In such case,
you may unwillingly loose your last copied data. For me, this major annoyance was caused by KiCad,
which automatically pre-selects footprint&rsquo;s reference designator in its properties window.
Anytime I wanted to paste new property, my selection was overridden.</p><p>This issue can be solved by applying this patch to <code>autocutsel</code>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#82071e;background-color:#ffebe9>--- autocutsel.c
</span></span></span><span style=display:flex><span><span style=color:#82071e;background-color:#ffebe9></span><span style=color:#116329;background-color:#dafbe1>+++ autocutsel.c
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1></span>@@ -208,6 +208,28 @@
</span></span><span style=display:flex><span>   XFree(value);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+static int OwnerIgnored(Widget w, Atom *selection)
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+{
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+  int status = 0;
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+  Window selection_owner = XGetSelectionOwner(XtDisplay(w), *selection);
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+  // Print the selection owner window ID
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+  if (selection_owner != None) {
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      char* name = NULL;
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      XFetchName(dpy, selection_owner, &amp;name);
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      if (options.debug) {
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+          printf(&#34;The current selection owner is: %s\n&#34;, name);
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      }
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      if (name &amp;&amp; strcmp(name, &#34;kicad&#34;) == 0) {
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+          if (options.debug) {
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+              printf(&#34;Selection ignored\n&#34;);
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+          }
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+          status = 1;
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      }
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      free((void*)name);
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+  }
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+  return status;
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+}
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1></span> // Called when the requested selection value is availiable
</span></span><span style=display:flex><span> static void SelectionReceived(Widget w, XtPointer client_data, Atom *selection,
</span></span><span style=display:flex><span>                               Atom *type, XtPointer value,
</span></span><span style=display:flex><span>@@ -217,6 +239,11 @@
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   if (*type != 0 &amp;&amp; *type != XT_CONVERT_FAIL) {
</span></span><span style=display:flex><span>     if (length &gt; 0 &amp;&amp; ValueDiffers(value, length)) {
</span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      if (strcmp(options.selection_name, &#34;PRIMARY&#34;) == 0 &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+          OwnerIgnored(w, selection)) {
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+        XtFree(value);
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+        return;
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1>+      }
</span></span></span><span style=display:flex><span><span style=color:#116329;background-color:#dafbe1></span>       if (options.debug) {
</span></span><span style=display:flex><span>         printf(&#34;Selection changed: &#34;);
</span></span><span style=display:flex><span>         PrintValue((char*)value, length);
</span></span></code></pre></td></tr></table></div></div><p>The way it works is simple. Each new PRIMARY selection is filtered by its original owner name before it is further processed.
When owner happens to be equal <code>kicad</code> it is just ignored.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.uninformativ.de/blog/postings/2017-04-02/0/POSTING-en.html>https://www.uninformativ.de/blog/postings/2017-04-02/0/POSTING-en.html</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://github.com/sigmike/autocutsel>https://github.com/sigmike/autocutsel</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div><footer><a href=https://adamws.github.io/>Back to Home</a></footer></body></html>